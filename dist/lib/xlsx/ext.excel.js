var MSSimpleExcel=function(e,t,r){var a=!0,n=new ActiveXObject("Excel.Application"),i=n.Workbooks.Add(),l=i.ActiveSheet,o=l.Range(l.Cells(1,1),l.Cells(t.length,t[0].length));o.Cells.Borders.Weight=1,o.Cells.NumberFormatLocal="@";for(var s=0;s<t.length;s++)for(var c=t[s],d=0;d<c.length;d++)l.Cells(s+1,d+1).Value=c[d];if(o.Columns.AutoFit(),"export"==e)try{i.SaveAs(r)}catch(e){a=!1}else"print"==e&&(l.PageSetup.Zoom=!1,l.PageSetup.FitToPagesWide=1,l.PageSetup.PaperSize=8,l.printout());return i.Close(savechanges=!1),i=l=null,n.Quit(),n=null,a},XLSXSimpleExcel=function(e,t,r){for(var a=[],n=1;n<t.length;n++){for(var i={},l=t[n],o=0;o<l.length;o++)i[t[0][o]]=l[o];a.push(i)}var s=XLSX.utils.book_new(),c=XLSX.utils.json_to_sheet(a);XLSX.utils.book_append_sheet(s,c,"sheet1"),XLSX.writeFile(s,r)};!function(e){function t(e,t){var r=document.getElementsByTagName("head")[0],a=document.createElement("script");a.type="text/javascript",a.src=e,"function"==typeof t&&(a.onload=a.onreadystatechange=function(){this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(t&&t(),a.onload=a.onreadystatechange=null)}),r.appendChild(a)}var r=document.getElementsByTagName("script"),r=r[r.length-1].getAttribute("src"),o=!0;function s(e,t,r){return("export"!=e||o?MSSimpleExcel:XLSXSimpleExcel)(e,t,r)}-1==window.navigator.userAgent.indexOf("MSIE")&&(o=!1,(r=r.split("/")).pop(),t((r=r.join("/"))+"/Blob.js"),t(r+"/FileSaver.js"),t(r+"/xlsx.core.min.js"));var u=function(e){return e.replace(/(<[^>]+>)|(&nbsp;)/gi,"")};function c(e,t){var r=[],a=e.getColumnModel().config,n=[];for(i=0;i<a.length;i++)""==(s=a[i]).header||s.hidden||"checker"==s.id||n.push(s.header);r.push(n);for(var l=t.data.items,o=0;o<l.length;o++){var s,c,d=l[o],n=[];for(i=0;i<a.length;i++)""==(s=a[i]).header||s.hidden||"checker"==s.id||(c=d.data[s.dataIndex]||"",s.renderer&&(c=u(s.renderer(c,"",d))),n.push(c.replace(/&#160;/gi,"")));r.push(n)}return r}e.doExport=function(r,e){if(o=e.IE11IsLowIE&&(window.ActiveXObject||"ActiveXObject"in window)?!0:o){var t=function(){try{var e=new ActiveXObject("Shell.Application").BrowseForFolder(0,"��ѡ��·��",64,17);if(null!=e)return"\\"!=(e=(e=(e=e.items()).item()).Path).charAt(e.length-1)&&(e+="\\"),e}catch(e){alert(e.message)}}();if(!t)return void alert("��ѡ����ȡ��");var a=t+e.filename}else a=e.filename+".xlsx";var n,i,l;return e.currentPage?(l=Ext.Msg.show({title:"��ʾ",msg:"���ڵ������ݣ�����ˢ�»�ر�ҳ�棬���Ժ�...",width:300,closable:!1}),n=c(r,r.getStore()),setTimeout(function(){var e=s("export",n,a);l.hide(),!1===e?alert("����ʧ��"):alert("�����ɹ�\n"+a)},0)):e.allPage&&(t=r.getStore(),e=new Ext.data.HttpProxy(new Ext.data.Connection({url:t.proxy.url})),i=new Ext.data.Store({proxy:e,reader:t.reader}),(e=Ext.apply({},t.lastOptions.params)).start=0,e.limit=9999,l=Ext.Msg.show({title:"��ʾ",msg:"���ڵ������ݣ�����ˢ�»�ر�ҳ�棬���Ժ�...",width:300,closable:!1}),i.load({params:e,callback:function(e){var t=c(r,i);setTimeout(function(){var e=s("export",t,a);l.hide(),!1===e?alert("����ʧ��"):alert("�����ɹ�\n"+a)},0)}})),a}}(window);