var common={};String.prototype.escapeJquery=function(){for(var e=this,t=["\\","^","$","*","?",".","+","(",")","[","]","|","{","}"],n=["~","`","@","#","%","&","=","'",'"',":",";","<",">",",","/"],o=0;o<t.length;o++)e=e.replace(new RegExp("\\"+t[o],"g"),"\\"+t[o]);for(o=0;o<n.length;o++)e=e.replace(new RegExp(n[o],"g"),"\\"+n[o]);return e},common.getData=function(e,t){for(var n={},o=0,a=e.length;o<a;o++){var i,r,s,c=e[o];"string"==typeof c?(s=c.substring("string"==typeof t?t.length:0),0<(i=$("#"+c.escapeJquery())).length&&(n[s]=$.trim(i.val()))):"object"==typeof c&&(i=$("#"+c.id.escapeJquery()),0!=(i=c.type&&"radio"==c.type?$("input[name='"+c.id+"']:checked"):i).length)&&(r="",r=c.type&&$.fn[c.type]?"radio"==c.type?i.val():"checkbox"==c.type||"switchbox"==c.type?i[c.type]("getValue")?1:0:c.multiple?i[c.type]("getValues").join(","):i[c.type]("getValue"):$.trim(i.val()),c.fn&&(r=c.fn(r)),n[s=c.id.substring("string"==typeof t?t.length:0)]=r)}return n},common.setData=function(e,t,n){for(var o={},a=0,i=e.length;a<i;a++){var r,s,c,l=e[a];"string"==typeof l?(r=l.substring("string"==typeof t?t.length:0),0<(s=$("#"+l.escapeJquery())).length&&s.val(n[r]||"")):"object"==typeof l&&(r=l.id.substring("string"==typeof t?t.length:0),s=$("#"+l.id.escapeJquery()),0!=(s=l.type&&"radio"==l.type?$("input[name='"+l.id+"'][value='"+n[r]+"']"):s).length)&&(l.type&&$.fn[l.type]?"radio"==l.type?s.radio("check"):"checkbox"==l.type||"switchbox"==l.type?s[l.type]("setValue",1==n[r]):l.multiple?s[l.type]("setValues",(n[r]||"").split(",")):"combogrid"==l.type&&l.text?(o[l.id]={onLoadSuccess:s.combogrid("options").onLoadSuccess,value:n[r]},s.combogrid("options").onLoadSuccess=function(){var e=$(this).attr("id");$(this).combogrid("setValue",o[e].value),o[e].onLoadSuccess.apply(this,arguments),$(this).combogrid("options").onLoadSuccess=o[e].onLoadSuccess},c=l.text.substring("string"==typeof t?t.length:0),s.combogrid("options").keyHandler.query.call(s[0],n[c]),s.combogrid("options").lazy&&(s.combo("options").queryOnFirstArrowDown=!1)):s[l.type]("setValue",n[r]||n[r]||""):s.val(n[r]||""))}},common.setDataByRow=function(e,t){2==arguments.length&&common.setData(e,"",t),3==arguments.length&&common.setData(e,t,arguments[2])},common.clearData=function(e){for(var t=0,n=e.length;t<n;t++){var o,a=e[t];"string"==typeof a?0<(o=$("#"+a.escapeJquery())).length&&o.val(""):"object"==typeof a&&(o=$("#"+a.id.escapeJquery()),0!=(o=a.type&&"radio"==a.type?$("input[name='"+a.id+"']:checked"):o).length)&&(a.type&&$.fn[a.type]?"radio"==a.type?o.radio("uncheck"):"checkbox"==a.type||"switchbox"==a.type?o[a.type]("setValue",!0):o[a.type]("setValue",""):o.val(""))}},common.disable=function(e,t){for(var n=0,o=e.length;n<o;n++){var a,i=e[n];"string"==typeof i?(a=$("#"+i.escapeJquery()),t&&-1<t.indexOf(i)||0<a.length&&a.attr("disabled","disabled")):"object"==typeof i&&(a=$("#"+i.id.escapeJquery()),0==(a=i.type&&"radio"==i.type?$("input[name='"+i.id+"']"):a).length||t&&-1<t.indexOf(i.id)||(i.type&&$.fn[i.type]?a[i.type]("disable"):a.attr("disabled","disabled")))}},common.enable=function(e,t){for(var n=0,o=e.length;n<o;n++){var a,i=e[n];"string"==typeof i?(a=$("#"+i.escapeJquery()),t&&-1<t.indexOf(i)||0<a.length&&a.removeAttr("disabled")):"object"==typeof i&&(a=$("#"+i.id.escapeJquery()),0==(a=i.type&&"radio"==i.type?$("input[name='"+i.id+"']"):a).length||t&&-1<t.indexOf(i.id)||(i.type&&$.fn[i.type]?a[i.type]("enable"):a.removeAttr("disabled")))}},common.transExcelData=function(e,c,l){var p;function t(e){var r=e.name,s=new FileReader;FileReader.prototype.readAsBinaryString||(FileReader.prototype.readAsBinaryString=function(e){var a="",i=this,r=new FileReader;r.onload=function(e){for(var t=new Uint8Array(r.result),n=t.byteLength,o=0;o<n;o++)a+=String.fromCharCode(t[o]);i.content=a,$(i).trigger("onload")},r.readAsArrayBuffer(e)}),s.onload=function(e){s.result&&(s.content=s.result),data=s.content,p=XLSX.read(data,{type:"binary"});var t,n=[];if(c.allSheet)for(var o=0,a=p.SheetNames.length;o<a;o++){var i=XLSX.utils.sheet_to_json(p.Sheets[p.SheetNames[o]]);n.push(i)}else{i=XLSX.utils.sheet_to_json(p.Sheets[p.SheetNames[0]]);n.push(i)}c.callbackOnce?(d[r]=n,y==++u&&"function"==typeof l&&l(d)):"function"==typeof l&&((t={})[r]=n,l(t))},s.readAsBinaryString(e)}"function"==typeof c&&(l=c,c={}),c=c||{};for(var d={},y=e.length,u=0,n=0;n<y;n++)t(e[n])},common.isIE=function(){return!!(window.ActiveXObject||"ActiveXObject"in window)},common.exportExcelByXLSX=function(e,t,n){(n=n||{}).sheetname=n.sheetname||"sheet1",n.filename=n.filename||"导出表",n.showHidden=!!n.showHidden;for(var o=[],a=0,i=e.length;a<i;a++)o.push(function(e,t,n,o){for(var a={},i=0;i<t.length;i++)for(var r=t[i],s=0;s<r.length;s++){var c,l,p=r[s];console.info("col",p),p.hidden&&!o||!p.field||(c=p.title||p.field,"function"==typeof p.formatter?(l=p.formatter(e[p.field]||"",e,n),a[c]=l):a[c]=e[p.field]||"")}return a}(e[a],t,a,n.showHidden));var r=XLSX.utils.book_new(),s=XLSX.utils.json_to_sheet(o);XLSX.utils.book_append_sheet(r,s,n.sheetname),XLSX.writeFile(r,n.filename+".xlsx")},common.exportExcelWithName=common.exportExcelByXLSX;