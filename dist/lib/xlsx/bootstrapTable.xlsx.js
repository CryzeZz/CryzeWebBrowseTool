!function(l){var r,d;function i(t,e,o){for(var s=o||{},i=(s.sheetname=s.sheetname||"sheet1",s.filename=s.filename||"导出表",s.showHidden=!!s.showHidden,[]),a=0,n=(t="function"==typeof s.filter?l.grep(t,function(t){return s.filter.call(window,t)}):t).length;a<n;a++)i.push(function(t,e,o,s){for(var i={},a=0;a<e.length;a++)for(var n=e[a],r=0;r<n.length;r++){var l,p,h=n[r];(h.visible||s)&&h.field&&(l=h.title||h.field,"function"==typeof h.formatter?(p=d(h.formatter(void 0===t[h.field]?"":t[h.field],t,o)),i[l]=p):i[l]=void 0===t[h.field]?"":t[h.field])}return i}(t[a],e,a,s.showHidden));var o=XLSX.utils.book_new(),r=XLSX.utils.json_to_sheet(i);XLSX.utils.book_append_sheet(o,r,s.sheetname),XLSX.writeFile(o,s.filename+".xlsx")}l&&l.fn&&l.fn.bootstrapTable&&l.BootstrapTable&&(l.fn.bootstrapTable.methods.push("exportXLSX"),r=l.fn.bootstrapTable.utils,l.BootstrapTable.prototype.initServer=function(o,t,e){var s=this,i={},a=this.header.fields.indexOf(this.options.sortName),n={searchText:this.searchText,sortName:this.options.sortName,sortOrder:this.options.sortOrder};this.header.sortNames[a]&&(n.sortName=this.header.sortNames[a]),this.options.pagination&&"server"===this.options.sidePagination&&(n.pageSize=this.options.pageSize===this.options.formatAllRows()?this.options.totalRows:this.options.pageSize,n.pageNumber=this.options.pageNumber),(e||this.options.url||this.options.ajax)&&("limit"===this.options.queryParamsType&&(n={search:n.searchText,sort:n.sortName,order:n.sortOrder},this.options.pagination)&&"server"===this.options.sidePagination&&(n.offset=this.options.pageSize===this.options.formatAllRows()?0:this.options.pageSize*(this.options.pageNumber-1),n.limit=this.options.pageSize===this.options.formatAllRows()?this.options.totalRows:this.options.pageSize,0===n.limit)&&delete n.limit,l.isEmptyObject(this.filterColumnsPartial)||(n.filter=JSON.stringify(this.filterColumnsPartial,null)),i=r.calculateObjectValue(this.options,this.options.queryParams,[n],i),l.extend(i,t||{}),!1!==i)&&(o||this.$tableLoading.show(),this.__lastQueryParams=i,a=l.extend({},r.calculateObjectValue(null,this.options.ajaxOptions),{type:this.options.method,url:e||this.options.url,data:"application/json"===this.options.contentType&&"post"===this.options.method?JSON.stringify(i):i,cache:this.options.cache,contentType:this.options.contentType,dataType:this.options.dataType,success:function(t){t=r.calculateObjectValue(s.options,s.options.responseHandler,[t],t);s.load(t),s.trigger("load-success",t),o||s.$tableLoading.hide()},error:function(t){var e=[];"server"===s.options.sidePagination&&((e={})[s.options.totalField]=0,e[s.options.dataField]=[]),s.load(e),s.trigger("load-error",t.status,t),o||s.$tableLoading.hide()}}),this.options.ajax?r.calculateObjectValue(this,this.options.ajax,[a],null):(this._xhr&&4!==this._xhr.readyState&&this._xhr.abort(),this._xhr=l.ajax(a)))},l.BootstrapTable.prototype.exportXLSX=function(e){e=e||{};var t,o=l.extend({},this.options),s=l.extend({},this.__lastQueryParams);e.method=(o.method||"POST").toLowerCase(),e.allPage?(t=o.url)&&""!=t?l.ajax({url:t,data:l.extend({},s,{page:1,rows:3e4}),type:e.method||"POST",dataType:"json"}).done(function(t){console.log(t),"object"==typeof t&&t instanceof Array?i(t,o.columns,e):"object"==typeof t.rows?i(t.rows,o.columns,e):t.IsSuccess?i(jQuery.parseJSON(t.Msg).rows,o.columns,e):alert(t.Msg||"错误")}):i(o.data||[],o.columns,e):i(this.getData.call(this,!0),o.columns,e)},d=function(t){return t.replace(/(<[^>]+>)|(&nbsp;)/gi,"")})}(jQuery);